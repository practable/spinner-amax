{"remainingRequest":"/home/david/practable/spinner-amax/ui/node_modules/babel-loader/lib/index.js!/home/david/practable/spinner-amax/ui/node_modules/cache-loader/dist/cjs.js??ref--1-0!/home/david/practable/spinner-amax/ui/node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--1-1!/home/david/practable/spinner-amax/ui/src/components/Streams.vue?vue&type=script&lang=js","dependencies":[{"path":"/home/david/practable/spinner-amax/ui/src/components/Streams.vue","mtime":1653472124341},{"path":"/home/david/practable/spinner-amax/ui/babel.config.js","mtime":1653472124337},{"path":"/home/david/practable/spinner-amax/ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/david/practable/spinner-amax/ui/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/david/practable/spinner-amax/ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/david/practable/spinner-amax/ui/node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiL2hvbWUvZGF2aWQvcHJhY3RhYmxlL3NwaW5uZXItYW1heC91aS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vb2JqZWN0U3ByZWFkMiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaXRlcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLnVybC1zZWFyY2gtcGFyYW1zLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc2VhcmNoLmpzIjsKaW1wb3J0IExvZ2dpbmdTdHJlYW0gZnJvbSAnLi9Mb2dnaW5nU3RyZWFtLnZ1ZSc7CmltcG9ydCBkYXlqcyBmcm9tICJkYXlqcyI7CmltcG9ydCB7IG1hcEdldHRlcnMgfSBmcm9tICd2dWV4JzsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJTdHJlYW1zIiwKICBjb21wb25lbnRzOiB7CiAgICBMb2dnaW5nU3RyZWFtOiBMb2dnaW5nU3RyZWFtCiAgfSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgY29ubmVjdGlvbkNoZWNrZXI6IG51bGwKICAgIH07CiAgfSwKICBjcmVhdGVkOiBmdW5jdGlvbiBjcmVhdGVkKCkge30sCiAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCgpIHsKICAgIGlmICh0aGlzLmdldFN0cmVhbXNPYnRhaW5lZCkgewogICAgICByZXR1cm47CiAgICB9CgogICAgdHJ5IHsKICAgICAgdmFyIHF1ZXJ5ID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh3aW5kb3cubG9jYXRpb24uc2VhcmNoKTsgLy9hZGQgdGhlIHN0cmVhbXMgZGF0YSB0byB0aGUgc3RvcmUKCiAgICAgIHZhciBzdHJlYW1zID0gcXVlcnkuZ2V0KCdzdHJlYW1zJyk7CiAgICAgIHZhciBkZWNvZGVkU3RyZWFtcyA9IEpTT04ucGFyc2UoZGVjb2RlVVJJQ29tcG9uZW50KFN0cmluZyhzdHJlYW1zKSkpOwogICAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgic2V0U3RyZWFtcyIsIGRlY29kZWRTdHJlYW1zKTsgLy9hZGQgZXhwaXJ5IHRpbWUgZGF0YSB0byBzdG9yZQoKICAgICAgdmFyIGV4cGlyZV90aW1lID0gcXVlcnkuZ2V0KCdleHAnKTsKICAgICAgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ3NldEV4cGlyeVRpbWUnLCBleHBpcmVfdGltZSk7IC8vc2V0dGluZyBjYW1lcmEgdHlwZQoKICAgICAgdmFyIGNhbSA9IHF1ZXJ5LmdldCgndicpOwogICAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnc2V0Q2FtZXJhJywgY2FtKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgY29uc29sZS5sb2coImVycm9yIGRlY29kaW5nIHN0cmVhbXMiKTsKICAgICAgdGhpcy4kc3RvcmUuZGlzcGF0Y2goImRlbGV0ZVN0cmVhbXMiKTsKICAgIH0gLy9yZWNvbm5lY3Rpb24gY29kZQoKCiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIHZhciBjdmIgPSBmdW5jdGlvbiBjdmIoKSB7CiAgICAgIF90aGlzLiRzdG9yZS5kaXNwYXRjaCgic2V0TGFzdFZpZGVvV3JpdGUiLCBkYXlqcygpLnZhbHVlT2YoKSk7IC8vbWlsbGlzZWNvbmRzCgogICAgfTsKCiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJqc21wZWc6d3JpdGUiLCBmdW5jdGlvbiAoKSB7CiAgICAgIGN2YigpOwogICAgfSk7CgogICAgdmFyIHdkID0gZnVuY3Rpb24gd2QoKSB7CiAgICAgIHZhciBsYyA9IF90aGlzLiRzdG9yZS5nZXR0ZXJzLmdldExhc3RWaWRlb0NoZWNrOwogICAgICB2YXIgbHcgPSBfdGhpcy4kc3RvcmUuZ2V0dGVycy5nZXRMYXN0VmlkZW9Xcml0ZTsKCiAgICAgIHZhciBkcm9wcGVkID0gZnVuY3Rpb24gZHJvcHBlZCgpIHsKICAgICAgICBfdGhpcy4kc3RvcmUuZGlzcGF0Y2goInNldENvbm5lY3Rpb25Jc0Ryb3BwZWQiLCB0cnVlKTsKCiAgICAgICAgX3RoaXMuJHN0b3JlLmRpc3BhdGNoKCJzZXRDb25uZWN0aW9uRHJvcHBlZEF0IiwgZGF5anMoKS51bml4KCkpOyAvL3NlY29uZHMKCgogICAgICAgIHZhciByZWNvbm5lY3RFdmVudCA9IG5ldyBFdmVudCgic3RyZWFtczpkcm9wcGVkIik7CiAgICAgICAgZG9jdW1lbnQuZGlzcGF0Y2hFdmVudChyZWNvbm5lY3RFdmVudCk7CiAgICAgIH07CgogICAgICBpZiAobGMgPiBsdykgewogICAgICAgIC8vIG5vIHdyaXRlIHNpbmNlIGxhc3QgY2hlY2sKICAgICAgICBpZiAoX3RoaXMuJHN0b3JlLmdldHRlcnMuZ2V0Q29ubmVjdGlvbklzRHJvcHBlZCkgewogICAgICAgICAgdmFyIHdoZW4gPSBfdGhpcy4kc3RvcmUuZ2V0dGVycy5nZXRDb25uZWN0aW9uRHJvcHBlZEF0OwogICAgICAgICAgdmFyIHNpbmNlID0gZGF5anMoKS51bml4KCkgLSB3aGVuOwoKICAgICAgICAgIGlmIChzaW5jZSA+IDEwKSB7CiAgICAgICAgICAgIC8vb2ggb2gsIGhhdmVuJ3QgbWFuYWdlZCB0byByZWNvbm5lY3QsIGxldCdzIHRyeSBhZ2FpbgogICAgICAgICAgICAvLyBub3RlIG9uIHNsb3cgbmV0d29yayBvciBoZWF2eSBsb2FkIG9uIHJlbGF5LWFjY2VzcywgdGhpcyBtaWdodCB0aW1lIG91dCBvdmVyIGFuZCBvdmVyIGFnYWluCiAgICAgICAgICAgIC8vIGJ1dCB1c2VyIGV4cGVyaWVuY2Ugb24gYSBuZXR3b3JrIHRoYXQgc2xvdy9zZXJ2ZXIgdGhhdCBsb2FkZWQgaXMgcXVlc3Rpb25hYmxlIGFueXdheQogICAgICAgICAgICAvLyBnaXZlbiB1c3VhbGx5IGNvbm5lY3QgZGVsYXkgaXMgIDw8MXNlYzsgc28gd2UgbWlnaHQgY29uc2lkZXIgdGhhdCBhbiBlZGdlIGNhc2Ugd2UgYXJlCiAgICAgICAgICAgIC8vIG5vdCBsaWtlbHkgdG8gaGl0LCBzbyBsb25nIGFzIHByb3Zpc2lvbmluZyBpcyBvayAoU2VydmVyIHNpZGUpCiAgICAgICAgICAgIC8vIGFzIGZvciB1c2VyIG5ldHdvcmsgcXVhbGl0eSwgbmV2ZXIgc2F5IG5ldmVyLi4uLgogICAgICAgICAgICBkcm9wcGVkKCk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgZHJvcHBlZCgpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vY29ubmVjdGlvbiBPSwogICAgICAgIF90aGlzLiRzdG9yZS5kaXNwYXRjaCgic2V0TGFzdFZpZGVvQ2hlY2siLCBkYXlqcygpLnZhbHVlT2YoKSk7IC8vbWlsbGlzZWNvbmRzCgoKICAgICAgICBfdGhpcy4kc3RvcmUuZGlzcGF0Y2goInNldENvbm5lY3Rpb25Jc0Ryb3BwZWQiLCBmYWxzZSk7CiAgICAgIH0KICAgIH07CgogICAgdGhpcy5jb25uZWN0aW9uQ2hlY2tlciA9IHNldEludGVydmFsKHdkLCAxMDAwKTsKICB9LAogIGNvbXB1dGVkOiBfb2JqZWN0U3ByZWFkKHt9LCBtYXBHZXR0ZXJzKFsnZ2V0U3RyZWFtc09idGFpbmVkJywgJ2dldFNlc3Npb25FeHBpcmVkJ10pKSwKICB3YXRjaDogewogICAgZ2V0U2Vzc2lvbkV4cGlyZWQ6IGZ1bmN0aW9uIGdldFNlc3Npb25FeHBpcmVkKGV4cGlyZWQpIHsKICAgICAgaWYgKGV4cGlyZWQpIHsKICAgICAgICBjbGVhckludGVydmFsKHRoaXMuY29ubmVjdGlvbkNoZWNrZXIpOwogICAgICB9CiAgICB9CiAgfSwKICBtZXRob2RzOiB7fQp9Ow=="},{"version":3,"sources":["/home/david/practable/spinner-amax/ui/src/components/Streams.vue"],"names":[],"mappings":"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","sourcesContent":["//Vue3 updated\n\n<template>\n  <div>\n    <!-- A non-rendered component that sets up the streams -->\n    <logging-stream />\n  </div>\n</template> \n\n<script>\n\nimport LoggingStream from './LoggingStream.vue'; \nimport dayjs from \"dayjs\";\nimport { mapGetters } from 'vuex';\n\nexport default {\n  name: \"Streams\",\n  components: {\n    LoggingStream,\n  },\n  data(){\n    return{\n      connectionChecker: null,\n    }\n  },\n  created(){\n      \n    },\n  mounted() {\n    if (this.getStreamsObtained) {\n      return;\n    }\n    try {\n      let query = new URLSearchParams(window.location.search);\n      //add the streams data to the store\n      let streams = query.get('streams');\n      let decodedStreams = JSON.parse(decodeURIComponent(String(streams)));\n      this.$store.dispatch(\"setStreams\", decodedStreams);\n\n      //add expiry time data to store\n      let expire_time = query.get('exp');\n      this.$store.dispatch('setExpiryTime', expire_time);\n\n      //setting camera type\n      let cam = query.get('v');\n      this.$store.dispatch('setCamera', cam);\n\n    } catch (e) {\n      console.log(\"error decoding streams\");\n      this.$store.dispatch(\"deleteStreams\");\n      \n    }\n\n\n    //reconnection code\n    var _this = this;\n    var cvb = function () {\n      _this.$store.dispatch(\"setLastVideoWrite\", dayjs().valueOf()); //milliseconds\n    };\n\n    document.addEventListener(\"jsmpeg:write\", function () {\n      cvb();\n    });\n\n    var wd = function(){\n       var lc = _this.$store.getters.getLastVideoCheck;\n      var lw = _this.$store.getters.getLastVideoWrite;\n\n      var dropped = function () {\n        \n        _this.$store.dispatch(\"setConnectionIsDropped\", true);\n        _this.$store.dispatch(\"setConnectionDroppedAt\", dayjs().unix()); //seconds\n        var reconnectEvent = new Event(\"streams:dropped\");\n            document.dispatchEvent(reconnectEvent);\n      };\n\n      if (lc > lw) {\n        // no write since last check\n        if (_this.$store.getters.getConnectionIsDropped) {\n          var when = _this.$store.getters.getConnectionDroppedAt;\n          var since = dayjs().unix() - when;\n          if (since > 10) {\n            //oh oh, haven't managed to reconnect, let's try again\n            // note on slow network or heavy load on relay-access, this might time out over and over again\n            // but user experience on a network that slow/server that loaded is questionable anyway\n            // given usually connect delay is  <<1sec; so we might consider that an edge case we are\n            // not likely to hit, so long as provisioning is ok (Server side)\n            // as for user network quality, never say never....\n            dropped();\n          }\n          return;\n        }\n        dropped();\n      } else {\n        //connection OK\n        _this.$store.dispatch(\"setLastVideoCheck\", dayjs().valueOf()); //milliseconds\n        _this.$store.dispatch(\"setConnectionIsDropped\", false);\n      }\n\n    };\n\n    this.connectionChecker = setInterval(wd, 1000);\n\n  },\n  computed: {\n    ...mapGetters([\n      'getStreamsObtained',\n      'getSessionExpired'\n    ]),\n  },\n  watch: {\n    getSessionExpired(expired){\n      if(expired){\n        clearInterval(this.connectionChecker);\n      }\n    }\n  },\n  methods:{\n    \n  },\n  \n};\n\n</script>"],"sourceRoot":""}]}