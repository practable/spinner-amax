{"remainingRequest":"/home/david/practable/spinner-amax/ui/node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--1-1!/home/david/practable/spinner-amax/ui/src/components/Streams.vue?vue&type=template&id=102bbd1a","dependencies":[{"path":"/home/david/practable/spinner-amax/ui/src/components/Streams.vue","mtime":1653472124341},{"path":"/home/david/practable/spinner-amax/ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/david/practable/spinner-amax/ui/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/david/practable/spinner-amax/ui/node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/templateLoader.js","mtime":499162500000},{"path":"/home/david/practable/spinner-amax/ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/david/practable/spinner-amax/ui/node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CiAgPGRpdj4KICAgIDwhLS0gQSBub24tcmVuZGVyZWQgY29tcG9uZW50IHRoYXQgc2V0cyB1cCB0aGUgc3RyZWFtcyAtLT4KICAgIDxsb2dnaW5nLXN0cmVhbSAvPgogIDwvZGl2Pgo="},{"version":3,"sources":["/home/david/practable/spinner-amax/ui/src/components/Streams.vue"],"names":[],"mappings":";EAGE,CAAC,CAAC,CAAC,CAAC;IACF,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;IACzD,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;EACnB,CAAC,CAAC,CAAC,CAAC,CAAC","file":"/home/david/practable/spinner-amax/ui/src/components/Streams.vue","sourceRoot":"","sourcesContent":["//Vue3 updated\n\n<template>\n  <div>\n    <!-- A non-rendered component that sets up the streams -->\n    <logging-stream />\n  </div>\n</template> \n\n<script>\n\nimport LoggingStream from './LoggingStream.vue'; \nimport dayjs from \"dayjs\";\nimport { mapGetters } from 'vuex';\n\nexport default {\n  name: \"Streams\",\n  components: {\n    LoggingStream,\n  },\n  data(){\n    return{\n      connectionChecker: null,\n    }\n  },\n  created(){\n      \n    },\n  mounted() {\n    if (this.getStreamsObtained) {\n      return;\n    }\n    try {\n      let query = new URLSearchParams(window.location.search);\n      //add the streams data to the store\n      let streams = query.get('streams');\n      let decodedStreams = JSON.parse(decodeURIComponent(String(streams)));\n      this.$store.dispatch(\"setStreams\", decodedStreams);\n\n      //add expiry time data to store\n      let expire_time = query.get('exp');\n      this.$store.dispatch('setExpiryTime', expire_time);\n\n      //setting camera type\n      let cam = query.get('v');\n      this.$store.dispatch('setCamera', cam);\n\n    } catch (e) {\n      console.log(\"error decoding streams\");\n      this.$store.dispatch(\"deleteStreams\");\n      \n    }\n\n\n    //reconnection code\n    var _this = this;\n    var cvb = function () {\n      _this.$store.dispatch(\"setLastVideoWrite\", dayjs().valueOf()); //milliseconds\n    };\n\n    document.addEventListener(\"jsmpeg:write\", function () {\n      cvb();\n    });\n\n    var wd = function(){\n       var lc = _this.$store.getters.getLastVideoCheck;\n      var lw = _this.$store.getters.getLastVideoWrite;\n\n      var dropped = function () {\n        \n        _this.$store.dispatch(\"setConnectionIsDropped\", true);\n        _this.$store.dispatch(\"setConnectionDroppedAt\", dayjs().unix()); //seconds\n        var reconnectEvent = new Event(\"streams:dropped\");\n            document.dispatchEvent(reconnectEvent);\n      };\n\n      if (lc > lw) {\n        // no write since last check\n        if (_this.$store.getters.getConnectionIsDropped) {\n          var when = _this.$store.getters.getConnectionDroppedAt;\n          var since = dayjs().unix() - when;\n          if (since > 10) {\n            //oh oh, haven't managed to reconnect, let's try again\n            // note on slow network or heavy load on relay-access, this might time out over and over again\n            // but user experience on a network that slow/server that loaded is questionable anyway\n            // given usually connect delay is  <<1sec; so we might consider that an edge case we are\n            // not likely to hit, so long as provisioning is ok (Server side)\n            // as for user network quality, never say never....\n            dropped();\n          }\n          return;\n        }\n        dropped();\n      } else {\n        //connection OK\n        _this.$store.dispatch(\"setLastVideoCheck\", dayjs().valueOf()); //milliseconds\n        _this.$store.dispatch(\"setConnectionIsDropped\", false);\n      }\n\n    };\n\n    this.connectionChecker = setInterval(wd, 1000);\n\n  },\n  computed: {\n    ...mapGetters([\n      'getStreamsObtained',\n      'getSessionExpired'\n    ]),\n  },\n  watch: {\n    getSessionExpired(expired){\n      if(expired){\n        clearInterval(this.connectionChecker);\n      }\n    }\n  },\n  methods:{\n    \n  },\n  \n};\n\n</script>"]}]}