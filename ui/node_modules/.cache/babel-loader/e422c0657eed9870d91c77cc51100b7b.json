{"remainingRequest":"/home/david/spinner-amax/ui/node_modules/thread-loader/dist/cjs.js!/home/david/spinner-amax/ui/node_modules/babel-loader/lib/index.js!/home/david/spinner-amax/ui/node_modules/cache-loader/dist/cjs.js??ref--1-0!/home/david/spinner-amax/ui/node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--1-1!/home/david/spinner-amax/ui/src/components/Streams.vue?vue&type=script&lang=js","dependencies":[{"path":"/home/david/spinner-amax/ui/src/components/Streams.vue","mtime":1653472124341},{"path":"/home/david/spinner-amax/ui/babel.config.js","mtime":1653472124337},{"path":"/home/david/spinner-amax/ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/david/spinner-amax/ui/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/david/spinner-amax/ui/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/david/spinner-amax/ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/david/spinner-amax/ui/node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiL2hvbWUvZGF2aWQvc3Bpbm5lci1hbWF4L3VpL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RTcHJlYWQyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIudXJsLXNlYXJjaC1wYXJhbXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zZWFyY2guanMiOwppbXBvcnQgTG9nZ2luZ1N0cmVhbSBmcm9tICcuL0xvZ2dpbmdTdHJlYW0udnVlJzsKaW1wb3J0IGRheWpzIGZyb20gImRheWpzIjsKaW1wb3J0IHsgbWFwR2V0dGVycyB9IGZyb20gJ3Z1ZXgnOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIlN0cmVhbXMiLAogIGNvbXBvbmVudHM6IHsKICAgIExvZ2dpbmdTdHJlYW06IExvZ2dpbmdTdHJlYW0KICB9LAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBjb25uZWN0aW9uQ2hlY2tlcjogbnVsbAogICAgfTsKICB9LAogIGNyZWF0ZWQ6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7fSwKICBtb3VudGVkOiBmdW5jdGlvbiBtb3VudGVkKCkgewogICAgaWYgKHRoaXMuZ2V0U3RyZWFtc09idGFpbmVkKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB0cnkgewogICAgICB2YXIgcXVlcnkgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gpOyAvL2FkZCB0aGUgc3RyZWFtcyBkYXRhIHRvIHRoZSBzdG9yZQoKICAgICAgdmFyIHN0cmVhbXMgPSBxdWVyeS5nZXQoJ3N0cmVhbXMnKTsKICAgICAgdmFyIGRlY29kZWRTdHJlYW1zID0gSlNPTi5wYXJzZShkZWNvZGVVUklDb21wb25lbnQoU3RyaW5nKHN0cmVhbXMpKSk7CiAgICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCJzZXRTdHJlYW1zIiwgZGVjb2RlZFN0cmVhbXMpOyAvL2FkZCBleHBpcnkgdGltZSBkYXRhIHRvIHN0b3JlCgogICAgICB2YXIgZXhwaXJlX3RpbWUgPSBxdWVyeS5nZXQoJ2V4cCcpOwogICAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnc2V0RXhwaXJ5VGltZScsIGV4cGlyZV90aW1lKTsgLy9zZXR0aW5nIGNhbWVyYSB0eXBlCgogICAgICB2YXIgY2FtID0gcXVlcnkuZ2V0KCd2Jyk7CiAgICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdzZXRDYW1lcmEnLCBjYW0pOwogICAgfSBjYXRjaCAoZSkgewogICAgICBjb25zb2xlLmxvZygiZXJyb3IgZGVjb2Rpbmcgc3RyZWFtcyIpOwogICAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgiZGVsZXRlU3RyZWFtcyIpOwogICAgfSAvL3JlY29ubmVjdGlvbiBjb2RlCgoKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgdmFyIGN2YiA9IGZ1bmN0aW9uIGN2YigpIHsKICAgICAgX3RoaXMuJHN0b3JlLmRpc3BhdGNoKCJzZXRMYXN0VmlkZW9Xcml0ZSIsIGRheWpzKCkudmFsdWVPZigpKTsgLy9taWxsaXNlY29uZHMKCiAgICB9OwoKICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImpzbXBlZzp3cml0ZSIsIGZ1bmN0aW9uICgpIHsKICAgICAgY3ZiKCk7CiAgICB9KTsKCiAgICB2YXIgd2QgPSBmdW5jdGlvbiB3ZCgpIHsKICAgICAgdmFyIGxjID0gX3RoaXMuJHN0b3JlLmdldHRlcnMuZ2V0TGFzdFZpZGVvQ2hlY2s7CiAgICAgIHZhciBsdyA9IF90aGlzLiRzdG9yZS5nZXR0ZXJzLmdldExhc3RWaWRlb1dyaXRlOwoKICAgICAgdmFyIGRyb3BwZWQgPSBmdW5jdGlvbiBkcm9wcGVkKCkgewogICAgICAgIF90aGlzLiRzdG9yZS5kaXNwYXRjaCgic2V0Q29ubmVjdGlvbklzRHJvcHBlZCIsIHRydWUpOwoKICAgICAgICBfdGhpcy4kc3RvcmUuZGlzcGF0Y2goInNldENvbm5lY3Rpb25Ecm9wcGVkQXQiLCBkYXlqcygpLnVuaXgoKSk7IC8vc2Vjb25kcwoKCiAgICAgICAgdmFyIHJlY29ubmVjdEV2ZW50ID0gbmV3IEV2ZW50KCJzdHJlYW1zOmRyb3BwZWQiKTsKICAgICAgICBkb2N1bWVudC5kaXNwYXRjaEV2ZW50KHJlY29ubmVjdEV2ZW50KTsKICAgICAgfTsKCiAgICAgIGlmIChsYyA+IGx3KSB7CiAgICAgICAgLy8gbm8gd3JpdGUgc2luY2UgbGFzdCBjaGVjawogICAgICAgIGlmIChfdGhpcy4kc3RvcmUuZ2V0dGVycy5nZXRDb25uZWN0aW9uSXNEcm9wcGVkKSB7CiAgICAgICAgICB2YXIgd2hlbiA9IF90aGlzLiRzdG9yZS5nZXR0ZXJzLmdldENvbm5lY3Rpb25Ecm9wcGVkQXQ7CiAgICAgICAgICB2YXIgc2luY2UgPSBkYXlqcygpLnVuaXgoKSAtIHdoZW47CgogICAgICAgICAgaWYgKHNpbmNlID4gMTApIHsKICAgICAgICAgICAgLy9vaCBvaCwgaGF2ZW4ndCBtYW5hZ2VkIHRvIHJlY29ubmVjdCwgbGV0J3MgdHJ5IGFnYWluCiAgICAgICAgICAgIC8vIG5vdGUgb24gc2xvdyBuZXR3b3JrIG9yIGhlYXZ5IGxvYWQgb24gcmVsYXktYWNjZXNzLCB0aGlzIG1pZ2h0IHRpbWUgb3V0IG92ZXIgYW5kIG92ZXIgYWdhaW4KICAgICAgICAgICAgLy8gYnV0IHVzZXIgZXhwZXJpZW5jZSBvbiBhIG5ldHdvcmsgdGhhdCBzbG93L3NlcnZlciB0aGF0IGxvYWRlZCBpcyBxdWVzdGlvbmFibGUgYW55d2F5CiAgICAgICAgICAgIC8vIGdpdmVuIHVzdWFsbHkgY29ubmVjdCBkZWxheSBpcyAgPDwxc2VjOyBzbyB3ZSBtaWdodCBjb25zaWRlciB0aGF0IGFuIGVkZ2UgY2FzZSB3ZSBhcmUKICAgICAgICAgICAgLy8gbm90IGxpa2VseSB0byBoaXQsIHNvIGxvbmcgYXMgcHJvdmlzaW9uaW5nIGlzIG9rIChTZXJ2ZXIgc2lkZSkKICAgICAgICAgICAgLy8gYXMgZm9yIHVzZXIgbmV0d29yayBxdWFsaXR5LCBuZXZlciBzYXkgbmV2ZXIuLi4uCiAgICAgICAgICAgIGRyb3BwZWQoKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBkcm9wcGVkKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy9jb25uZWN0aW9uIE9LCiAgICAgICAgX3RoaXMuJHN0b3JlLmRpc3BhdGNoKCJzZXRMYXN0VmlkZW9DaGVjayIsIGRheWpzKCkudmFsdWVPZigpKTsgLy9taWxsaXNlY29uZHMKCgogICAgICAgIF90aGlzLiRzdG9yZS5kaXNwYXRjaCgic2V0Q29ubmVjdGlvbklzRHJvcHBlZCIsIGZhbHNlKTsKICAgICAgfQogICAgfTsKCiAgICB0aGlzLmNvbm5lY3Rpb25DaGVja2VyID0gc2V0SW50ZXJ2YWwod2QsIDEwMDApOwogIH0sCiAgY29tcHV0ZWQ6IF9vYmplY3RTcHJlYWQoe30sIG1hcEdldHRlcnMoWydnZXRTdHJlYW1zT2J0YWluZWQnLCAnZ2V0U2Vzc2lvbkV4cGlyZWQnXSkpLAogIHdhdGNoOiB7CiAgICBnZXRTZXNzaW9uRXhwaXJlZDogZnVuY3Rpb24gZ2V0U2Vzc2lvbkV4cGlyZWQoZXhwaXJlZCkgewogICAgICBpZiAoZXhwaXJlZCkgewogICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5jb25uZWN0aW9uQ2hlY2tlcik7CiAgICAgIH0KICAgIH0KICB9LAogIG1ldGhvZHM6IHt9Cn07"},{"version":3,"sources":["/home/david/spinner-amax/ui/src/components/Streams.vue"],"names":[],"mappings":"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","sourcesContent":["//Vue3 updated\n\n<template>\n  <div>\n    <!-- A non-rendered component that sets up the streams -->\n    <logging-stream />\n  </div>\n</template> \n\n<script>\n\nimport LoggingStream from './LoggingStream.vue'; \nimport dayjs from \"dayjs\";\nimport { mapGetters } from 'vuex';\n\nexport default {\n  name: \"Streams\",\n  components: {\n    LoggingStream,\n  },\n  data(){\n    return{\n      connectionChecker: null,\n    }\n  },\n  created(){\n      \n    },\n  mounted() {\n    if (this.getStreamsObtained) {\n      return;\n    }\n    try {\n      let query = new URLSearchParams(window.location.search);\n      //add the streams data to the store\n      let streams = query.get('streams');\n      let decodedStreams = JSON.parse(decodeURIComponent(String(streams)));\n      this.$store.dispatch(\"setStreams\", decodedStreams);\n\n      //add expiry time data to store\n      let expire_time = query.get('exp');\n      this.$store.dispatch('setExpiryTime', expire_time);\n\n      //setting camera type\n      let cam = query.get('v');\n      this.$store.dispatch('setCamera', cam);\n\n    } catch (e) {\n      console.log(\"error decoding streams\");\n      this.$store.dispatch(\"deleteStreams\");\n      \n    }\n\n\n    //reconnection code\n    var _this = this;\n    var cvb = function () {\n      _this.$store.dispatch(\"setLastVideoWrite\", dayjs().valueOf()); //milliseconds\n    };\n\n    document.addEventListener(\"jsmpeg:write\", function () {\n      cvb();\n    });\n\n    var wd = function(){\n       var lc = _this.$store.getters.getLastVideoCheck;\n      var lw = _this.$store.getters.getLastVideoWrite;\n\n      var dropped = function () {\n        \n        _this.$store.dispatch(\"setConnectionIsDropped\", true);\n        _this.$store.dispatch(\"setConnectionDroppedAt\", dayjs().unix()); //seconds\n        var reconnectEvent = new Event(\"streams:dropped\");\n            document.dispatchEvent(reconnectEvent);\n      };\n\n      if (lc > lw) {\n        // no write since last check\n        if (_this.$store.getters.getConnectionIsDropped) {\n          var when = _this.$store.getters.getConnectionDroppedAt;\n          var since = dayjs().unix() - when;\n          if (since > 10) {\n            //oh oh, haven't managed to reconnect, let's try again\n            // note on slow network or heavy load on relay-access, this might time out over and over again\n            // but user experience on a network that slow/server that loaded is questionable anyway\n            // given usually connect delay is  <<1sec; so we might consider that an edge case we are\n            // not likely to hit, so long as provisioning is ok (Server side)\n            // as for user network quality, never say never....\n            dropped();\n          }\n          return;\n        }\n        dropped();\n      } else {\n        //connection OK\n        _this.$store.dispatch(\"setLastVideoCheck\", dayjs().valueOf()); //milliseconds\n        _this.$store.dispatch(\"setConnectionIsDropped\", false);\n      }\n\n    };\n\n    this.connectionChecker = setInterval(wd, 1000);\n\n  },\n  computed: {\n    ...mapGetters([\n      'getStreamsObtained',\n      'getSessionExpired'\n    ]),\n  },\n  watch: {\n    getSessionExpired(expired){\n      if(expired){\n        clearInterval(this.connectionChecker);\n      }\n    }\n  },\n  methods:{\n    \n  },\n  \n};\n\n</script>"],"sourceRoot":""}]}